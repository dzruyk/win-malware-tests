#include "stdafx.h"

#include <Windows.h>
#include "../distorm3/include/distorm.h"

#pragma comment(lib, "C:\\Documents and Settings\\Admin\\Рабочий стол\\test_inj\\Release\\disassm.lib")

#define CODE_MAX 15
DWORD
get_opcode_len(LPVOID op)
{
	_DecodeResult res;
	_DecodedInst decodedInstructions;
	unsigned int readed, i, next;

	readed = 0;
#ifdef  _WIN64
	_DecodeType dt = Decode64Bits;
#else
	_DecodeType dt = Decode32Bits;
#endif

	res = distorm_decode(0,		// offset from begin of buffer
	    (const unsigned char*)op,
	    CODE_MAX,
	    dt,
	    &decodedInstructions,
	    1,				// Decode only one instruction
	    &readed);

	if (res != DECRES_SUCCESS ||
	    readed == 0) {
		return -1;
	return decodedInstructions.size;
}
